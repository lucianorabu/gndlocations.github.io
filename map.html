<!DOCTYPE html> <html> <head> <meta charset='utf-8' /> <title></title> <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script> <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script> <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script> <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css" /> <script src="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script> <link href="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css" rel="stylesheet" /> <script src='https://npmcdn.com/csv2geojson@latest/csv2geojson.js'></script> <style type='text/css' rel='stylesheet'>body { margin: 0; padding: 0; } #map { position: absolute; top: 0; bottom: 0; width: 100%; background: #D7F6FF; } /* Popup styling */ .mapboxgl-popup-close-button { display: none; } .mapboxgl-ctrl-geocoder.mapboxgl-ctrl { display: none; } a.mapboxgl-ctrl-logo { display: none; } .mapboxgl-popup { z-index: 10; } .mapboxgl-popup-content { padding: 0; width: min-content; min-width: 280px; max-width: 100vw; border-radius: 0; margin-left: -21px; } .marker { background-image: url(https://www.greennewdealuk.org/logo_white); background-size: cover; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; box-shadow: -3px 5px #06AC60; } .popup { font-family: "Source Sans Pro", sans-serif; } .popup #title { font-size: 18px; padding: 10px; background: #F8E91C; font-family: "Source Sans Pro", sans-serif; } .popup #join { background: #4CAE4A; font-size: 18px; padding: 8px 20px; margin: 15px 0; color: white; text-decoration: none; display: block; } .popup #join:hover { background: green; } .popup .body { text-align: center; margin: 12px; } .popup #contact { display: block; text-decoration: none; color: black; font-size: 14px; text-align: left; } .popup #contact:hover { color: green; }</style> <script type='text/javascript'>const initMap = () => { const accessToken = "pk.eyJ1IjoibHVjaWFub3JhYnUiLCJhIjoiY2tncGdudTFkMGEwZTJxdGQ1bjc2cGQzMyJ9.clTzJRrkDknTC8j4jLHcaA"; mapboxgl.accessToken = accessToken; const map = new mapboxgl.Map({ container: "map", style: "mapbox://styles/lucianorabu/ckgph9z1z3ud919qle3qpxv2h", /*stylesheet location*/ center: [-3.2765753, 54.7023545], /*starting position*/ zoom: 1, /*starting zoom*/ }); map.addControl( new MapboxGeocoder({ accessToken, mapboxgl, }), 'bottom-left' ); map.addControl(new mapboxgl.FullscreenControl(), 'bottom-left'); /*Add geolocate control to the map*/ map.addControl( new mapboxgl.GeolocateControl({ positionOptions: { enableHighAccuracy: true }, trackUserLocation: true }), 'bottom-left' ); /*add zoom and rotation controls to the map.*/ map.addControl(new mapboxgl.NavigationControl(), 'bottom-left'); return map; }; const loadmap = (data, map) => { map.on("load", () => { map.addSource("locationPoints", { type: "geojson", data: data, }); map.addLayer({ id: "points", type: "circle", source: "locationPoints", paint: { "circle-radius": 30, "circle-opacity": 0, }, }); data.features.forEach((marker) => { /*create a HTML element for each feature*/ var el = document.createElement('div'); el.className = 'marker'; new mapboxgl.Marker(el) .setLngLat(marker.geometry.coordinates) .addTo(map); }); /* When a click event occurs on a feature in the csvData layer, open a popup at the location of the feature, with description HTML from its properties.*/ map.on("click", "points", (e) => { map.flyTo({ center: e.features[0].geometry.coordinates }); var coordinates = e.features[0].geometry.coordinates.slice(); var htmlPopup = getPopup(e.features[0].properties) ; setTimeout(function(){ /*add Popup to map*/ new mapboxgl.Popup() .setLngLat(coordinates) .setHTML(htmlPopup) .addTo(map); }, 100); }); const line = turf.lineString(data.features.map(feature=> feature.geometry.coordinates)); const bbox = turf.bbox(line); map.fitBounds(bbox, { padding: 50 }); }); }; const getPopup = (properties) => { var htmlPopup = $('#location-popup-template').html(); Object.keys(properties).forEach((key,index) => { if (properties[key] != '') { htmlPopup = htmlPopup.replaceAll("%%%"+key.toUpperCase()+"%%%", properties[key]); } else { htmlPopup = htmlPopup.replace("href=\"%%%"+key.toUpperCase()+"%%%\"",""); } }); return htmlPopup; }; (($) => { $(document).ready(function () { /*/wp-content/uploads/2020/11/locations.json/* /*locations.json*/ $.getJSON('/wp-content/uploads/2020/11/locations.json', function(result){ loadmap(result, initMap()); }); }); })(jQuery); </script> </head> <body> <div id='map-container' style="max-width: 546px; max-height: 462px;"> <div id='map'/> </div> <div id="location-popup-template" style="display: none ;"> <div class="popup"> <div id="title">%%%LOCATION%%%</div> <div class="body"> <!-- <span>Contact: </span> --> <a id="contact" href="mailto:%%%CONTACT%%%">%%%CONTACT%%%</a> <a id="join" target="_blank" href='%%%JOIN%%%'>Join</a> </div> </div> </div> </body> </html> 